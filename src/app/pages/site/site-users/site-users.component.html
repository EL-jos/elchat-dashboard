<div class="users-container">

    <!-- SUMMARY -->
    <div class="summary" *ngIf="summary">
        <mat-card class="summary-card">
            <div>Total Users: {{ summary.total_users }}</div>
            <div>Vérifiés: {{ summary.verified_users }}</div>
            <div>Non Vérifiés: {{ summary.unverified_users }}</div>
        </mat-card>
    </div>

    <!-- TABLE CARD -->
    <mat-card class="el-card-table">

        <mat-card-title>Utilisateurs</mat-card-title>

        <mat-form-field appearance="outline" class="search-field">
            <mat-label>Rechercher</mat-label>
            <input matInput [(ngModel)]="filters.search" (keyup.enter)="loadUsers()" />
        </mat-form-field>

        <table mat-table [dataSource]="dataSource" class="mat-elevation-z1">

            <!-- Name -->
            <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef> Nom </th>
                <td mat-cell *matCellDef="let user">
                    {{ user.firstname }} {{ user.lastname }}
                </td>
            </ng-container>

            <!-- Email -->
            <ng-container matColumnDef="email">
                <th mat-header-cell *matHeaderCellDef> Email </th>
                <td mat-cell *matCellDef="let user">
                    {{ user.email }}
                </td>
            </ng-container>

            <!-- Conversations -->
            <ng-container matColumnDef="conversations">
                <th mat-header-cell *matHeaderCellDef> Conversations </th>
                <td mat-cell *matCellDef="let user">
                    {{ user.stats?.conversations_count }}
                </td>
            </ng-container>

            <!-- Messages -->
            <ng-container matColumnDef="messages">
                <th mat-header-cell *matHeaderCellDef> Messages </th>
                <td mat-cell *matCellDef="let user">
                    {{ user.stats?.messages_count }}
                </td>
            </ng-container>

            <!-- Last Seen -->
            <ng-container matColumnDef="last_seen">
                <th mat-header-cell *matHeaderCellDef> Dernière activité </th>
                <td mat-cell *matCellDef="let user">
                    {{ user.stats?.last_seen_at | date:'short' }}
                </td>
            </ng-container>

            <!-- Status -->
            <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef> Statut </th>
                <td mat-cell *matCellDef="let user">
                    <span [class.verified]="user.is_verified" [class.unverified]="!user.is_verified">
                        {{ user.is_verified ? 'Vérifié' : 'Non vérifié' }}
                    </span>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="selectUser(row)">
            </tr>
        </table>

        <mat-paginator [pageSize]="10"></mat-paginator>

    </mat-card>

    <!-- USER DETAILS + CHART -->
    <mat-card *ngIf="selectedUser" class="details-card">
        <mat-card-title>
            {{ selectedUser.firstname }} {{ selectedUser.lastname }}
        </mat-card-title>

        <p>{{ selectedUser.email }}</p>

        <h3>Activité</h3>
        <p-chart type="bar" [data]="chartData" [options]="chartOptions">
        </p-chart>

    </mat-card>

</div>